{% extends "base.html" %}

{% load i18n static wagtailcore_tags %}

{% block body_class %}template-rtei{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" type="text/css" href="{% static 'vendor/c3/c3.css' %}">
{% endblock %}

{% block content %}
  <div class="main">

    <style>
    /* TODO: Move out of here */

    #chart {
        height: 120px;
    }

    .indicator > div {
        float: left;
        display: block;
        padding: 5px 10px;
    }

    .indicator-title {
        width: 90%;
    }

    .indicator-value {
        text-align: center;
    }

    .indicators .level1 > div {
        background: #F97B5D;
        font-weight: bold;
    }

    .indicators .level2 > div {
        background: #FDE8DD;
    }

    .indicators .level2 .indicator-title {
        padding-left: 20px;
    }

    .indicators .level3 .indicator-title {
        padding-left: 40px;
    }

    .indicators .level4 .indicator-title {
        padding-left: 60px;
    }



    </style>


    <select id="available-countries">
     {% if not country_code %}
        <option value="">{% trans "Select a country ..." %}</option>
     {% endif %}
     {% for code, name in available_countries.iteritems %}
     <option value="{{ code }}" {% if code == country_code %}selected="selected"{% endif%}>{{ name }}</option>
     {% endfor %}
    </select>

    {% if country_code %}

    <section>

      <h1>{{ country_name }} ({{ country_code }})</h1>

      <div>{% trans "Overall Index" %}: {{ country_indicators.index }}</div>
      <div id="chart"></div>
    </section>

    <section>
        <div class="indicators" id="indicators">
            {% include 'rtei/tags/indicators.html' %}
        </div>
    </section>
    {% endif %}

  </div>

{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/country.js' %}"></script>
    <script src="{% static 'vendor/underscore-min.js' %}" type="text/javascript" charset="utf-8"></script>
    <script src="{% static 'vendor/d3/d3.min.js' %}" type="text/javascript" charset="utf-8"></script>
    <script src="{% static 'vendor/c3/c3.min.js' %}" type="text/javascript" ></script>
    <script type="text/javascript">
        var chart;
        var json_data;
        var build_chart = function(data) {
            // Chart height is the number of rows * 22, or 350, whichever is
            // largest. This ensures there is adequate room for double-lined
            // labels.
            var height = _.max([_.size(data) * 22, 350]);
            var chart = c3.generate({
                bindto: '#chart',
                data: {
                    json: data,
                    order: null,
                    keys: {
                        x: 'name',
                        value: ['1', '3', '2', '5', '4']
                    },
                    groups: [
                        ['1', '2', '3', '4', '5']
                    ],
                    names: {
                        '1': 'Governance',
                        '3': 'Accessibility',
                        '2': 'Availability',
                        '5': 'Adaptability',
                        '4': 'Acceptability'
                    },
                    type: 'bar'
                },
                axis: {
                    rotated: true,
                    x: {
                        type: 'category'
                    },
                    y: {
                        show: true,
                        max: 100,
                        padding: {
                            top: 0,
                        }
                    }
                },
                size: 22,
                bar: {
                    width: {
                        ratio: 0.75
                    }
                },
                tooltip: {
                  format: {
                    value: function (value, ratio, id, index) {
                        return parseFloat((value * 5).toFixed(2));
                    }
                  }
                }
            });
            return chart;
        };

        var data = {{ chart_data|safe }};
        build_chart(data);
    </script>
{% endblock %}
