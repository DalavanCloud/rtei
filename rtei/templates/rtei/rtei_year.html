{% extends "base.html" %}

{% load static %}

{% block body_class %}template-rtei{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" type="text/css" href="{% static 'vendor/c3/c3.css' %}">
{% endblock %}

{% block content %}
  <div class="main">
    <h1>Hi!</h1>

    <p>
        You are now on: {{ self.title }}
    </p>

    <div>
        <div id="chart"></div>

        {{ self.body }}
    </div>
  </div>

{% endblock %}

{% block extra_js %}
    <script src="{% static 'vendor/jquery-1.12.0.min.js' %}" type="text/javascript" charset="utf-8"></script>
    <script src="{% static 'vendor/underscore-min.js' %}" type="text/javascript" charset="utf-8"></script>
    <script src="{% static 'vendor/d3/d3.min.js' %}" type="text/javascript" charset="utf-8"></script>
    <script src="{% static 'vendor/c3/c3.min.js' %}" type="text/javascript" ></script>
    <script type="text/javascript">
        var chart;
        var json_data;
        var build_chart = function(data) {
            var chart = c3.generate({
                bindto: '#chart',
                data: {
                    json: data,
                    order: null,
                    keys: {
                        x: 'name',
                        value: ['1', '3', '2', '5', '4'],
                    },
                    groups: [
                        ['1', '2', '3', '4', '5'],
                    ],
                    names: {
                        '1': 'Governance',
                        '3': 'Accessibility',
                        '2': 'Availability',
                        '5': 'Adaptability',
                        '4': 'Acceptability'
                    },
                    type: 'bar'
                },
                axis: {
                    rotated: true,
                    x: {
                        type: 'category'
                    },
                    y: {
                        show: true,
                        max: 100,
                        padding: {
                            top: 0
                        }
                    }
                },
                bar: {
                    width: 65
                }
            });
            return chart;
        };
        var json_data = $.getJSON("{% static 'data/c3_scores_per_country.json' %}", function(data) {
            json_data = data;
            chart = build_chart(json_data);
        });

        var sortByKey = function(key, desc) {
            // Sort json_data by key and rebuild chart.
            json_data = _.sortBy(json_data, key);
            if (desc) json_data.reverse();
            chart = build_chart(json_data);
        };
    </script>
{% endblock %}
